<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Royal Baby Reveal â€” Boy or Girl</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --gold: #d4af37;
        --cream: #fff9f0;
        --rose: #ff9cb2;
        --royal: #6ea8ff;
        --bg1: #fffaf4;
        --bg2: #f1e5c7;
        --text: #3a2f1e;
        --muted: #8c7b60;
        --card-bg: rgba(255, 255, 255, 0.66);
        --radius: 20px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px;
      }

      .wrap {
        width: 100%;
        max-width: 960px;
      }
      .card {
        background: var(--card-bg);
        border-radius: calc(var(--radius)+6px);
        border: 1px solid rgba(212, 175, 55, 0.24);
        box-shadow: 0 24px 70px rgba(180, 145, 45, 0.2);
        padding: 26px;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      /* Header + shimmer */
      .header {
        text-align: center;
        margin-bottom: 10px;
        padding: 6px 0;
        position: relative;
      }
      .crest {
        font-family: "Playfair Display", serif;
        font-size: 40px;
        color: var(--text);
      }
      .title {
        font-family: "Playfair Display", serif;
        font-size: 30px;
        margin: 6px 0;
        color: var(--text);
        display: inline-block;
        position: relative;
        padding: 6px 14px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.35),
          rgba(255, 255, 255, 0.1)
        );
        border: 1px solid rgba(212, 175, 55, 0.18);
      }
      .title::before {
        content: "";
        position: absolute;
        left: -60%;
        top: 0;
        width: 40%;
        height: 100%;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0),
          rgba(255, 255, 255, 0.6),
          rgba(255, 255, 255, 0)
        );
        transform: skewX(-20deg);
        animation: shimmer 3.8s linear infinite;
        border-radius: 12px;
        mix-blend-mode: overlay;
      }
      @keyframes shimmer {
        0% {
          left: -60%;
        }
        50% {
          left: 120%;
        }
        100% {
          left: 120%;
        }
      }
      .sub {
        color: var(--muted);
        margin: 4px 0 10px;
        font-size: 14px;
      }

      /* countdown under title */
      .headerCount {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 12px 0 10px;
      }
      .countCard {
        background: rgba(255, 255, 255, 0.85);
        border-radius: 10px;
        padding: 8px 12px;
        border: 1px solid rgba(212, 175, 55, 0.12);
        min-width: 70px;
        text-align: center;
        font-weight: 800;
        color: var(--text);
      }
      .countLabel {
        font-size: 12px;
        color: var(--muted);
        font-weight: 600;
        margin-top: 4px;
      }

      /* single authoritative counters (top) */
      .teams {
        display: flex;
        gap: 18px;
        justify-content: center;
        margin-bottom: 18px;
      }
      .team-pill {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 18px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.68),
          rgba(255, 255, 255, 0.56)
        );
        border: 1px solid rgba(212, 175, 55, 0.16);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.06);
        min-width: 160px;
        justify-content: center;
      }
      .team-pill .label {
        font-weight: 700;
        color: var(--muted);
        margin-right: 8px;
      }
      .team-pill .count {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        color: var(--gold);
        font-size: 18px;
      }

      /* main layout */
      .grid {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 22px;
        align-items: start;
      }
      @media (max-width: 880px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .team-pill {
          min-width: auto;
        }
      }

      .choices {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }
      .choice {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.74),
          rgba(255, 255, 255, 0.64)
        );
        border-radius: 14px;
        padding: 18px;
        border: 1px solid rgba(212, 175, 55, 0.14);
        display: flex;
        align-items: center;
        gap: 16px;
        cursor: pointer;
        position: relative;
        transition: transform 0.16s ease, box-shadow 0.16s ease;
      }
      .choice:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
      }
      .choice.selected {
        transform: translateY(-12px);
        box-shadow: 0 24px 56px rgba(0, 0, 0, 0.12);
        border-color: rgba(212, 175, 55, 0.28);
      }
      .emoji {
        font-size: 44px;
        width: 64px;
        text-align: center;
      }
      .meta {
        display: flex;
        flex-direction: column;
      }
      .titleSmall {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 20px;
        margin-bottom: 4px;
      }
      .desc {
        color: var(--muted);
        font-size: 13px;
      }
      .choice::after {
        content: "";
        position: absolute;
        right: 12px;
        top: 12px;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: none;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 16px;
      }
      .choice.selected::after {
        display: flex;
      }
      .choice#boy.selected::after {
        background: linear-gradient(135deg, #f9e6b0, #f3d67a);
        color: #3a2f1e;
        content: "âœ”";
      }
      .choice#girl.selected::after {
        background: linear-gradient(135deg, #ffdbe6, #ffc0d1);
        color: #3a2f1e;
        content: "âœ”";
      }

      .panel {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.72),
          rgba(255, 255, 255, 0.64)
        );
        border-radius: 14px;
        padding: 16px;
        border: 1px solid rgba(212, 175, 55, 0.14);
      }
      .panel h3 {
        margin: 0 0 8px;
        font-family: "Playfair Display", serif;
      }
      .panel .muted {
        color: var(--muted);
        font-size: 13px;
        margin-bottom: 10px;
      }
      .inputs {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 10px;
      }
      .inputs input {
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(212, 175, 55, 0.12);
        background: transparent;
      }
      .cta {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .btnMain {
        background: linear-gradient(90deg, #f9e6b0, #f3d67a);
        border: 0;
        padding: 12px 14px;
        border-radius: 10px;
        font-weight: 800;
        cursor: pointer;
        color: #3a2f1e;
      }
      .btnGhost {
        background: transparent;
        border: 1px dashed rgba(212, 175, 55, 0.18);
        padding: 10px 12px;
        border-radius: 10px;
        cursor: pointer;
        color: var(--muted);
      }

      footer {
        text-align: center;
        color: var(--muted);
        margin-top: 16px;
        font-size: 13px;
      }

      .modalWrap {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(10, 10, 10, 0.4);
        z-index: 999;
      }
      .modal {
        background: white;
        padding: 18px;
        border-radius: 12px;
        max-width: 420px;
        width: 92%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        text-align: center;
      }
      .modal h2 {
        margin: 0 0 8px;
        font-family: "Playfair Display", serif;
        color: #2b1f14;
      }
      .modal p {
        color: #5b4b3a;
        margin: 8px 0 12px;
      }

      #confetti {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
      }

      @media (max-width: 880px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .teams {
          flex-direction: column;
          gap: 8px;
        }
        .team-pill {
          min-width: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card" id="card">
        <canvas id="confetti"></canvas>

        <div class="header">
          <div class="crest">ðŸ‘‘</div>
          <div class="title">Royal Baby Reveal</div>
          <p class="sub">
            Aman & Akanksha invite you â€” predict whether it will be a prince or
            princess
          </p>

          <!-- single countdown moved here -->
          <div class="headerCount" aria-hidden="false">
            <div class="countCard">
              <div id="cdDays">0</div>
              <div class="countLabel">Days</div>
            </div>
            <div class="countCard">
              <div id="cdHours">0</div>
              <div class="countLabel">Hours</div>
            </div>
            <div class="countCard">
              <div id="cdMins">0</div>
              <div class="countLabel">Mins</div>
            </div>
            <div class="countCard">
              <div id="cdSecs">0</div>
              <div class="countLabel">Secs</div>
            </div>
          </div>
        </div>

        <!-- ONLY authoritative counts (top) -->
        <div class="teams" aria-hidden="false">
          <div class="team-pill">
            <span class="label">Boy Votes</span
            ><span class="count" id="boyCount">0</span>
          </div>
          <div class="team-pill">
            <span class="label">Girl Votes</span
            ><span class="count" id="girlCount">0</span>
          </div>
        </div>

        <div class="grid">
          <div class="choices" aria-hidden="false">
            <div
              class="choice"
              id="boy"
              data-value="boy"
              role="button"
              tabindex="0"
              aria-pressed="false"
            >
              <div class="emoji">ðŸ¤´ðŸ’™</div>
              <div class="meta">
                <div class="titleSmall">It's a Boy!</div>
                <div class="desc">Choose if you predict a little prince</div>
              </div>
            </div>

            <div
              class="choice"
              id="girl"
              data-value="girl"
              role="button"
              tabindex="0"
              aria-pressed="false"
            >
              <div class="emoji">ðŸ‘¸ðŸ’–</div>
              <div class="meta">
                <div class="titleSmall">It's a Girl!</div>
                <div class="desc">Choose if you predict a little princess</div>
              </div>
            </div>
          </div>

          <div class="panel" aria-hidden="false">
            <h3>Make your prediction</h3>
            <div class="muted">
              Reveal Date: <strong>14 November 2025</strong>
            </div>

            <div class="inputs" style="margin-top: 12px">
              <input id="name" placeholder="Your Name (optional)" />
              <input
                id="relation"
                placeholder="Relation (e.g., Masi, Chachu)"
              />
            </div>

            <div class="cta" style="margin-top: 6px">
              <button class="btnMain" id="voteBtn">
                Submit Your Prediction
              </button>
              <button class="btnGhost" id="shareBtn">Share</button>
            </div>

            <div style="margin-top: 12px; font-size: 13px; color: var(--muted)">
              Tip: Enter your name to get a personalized thank-you after voting.
            </div>
          </div>
        </div>

        <footer>
          Made with love for Aman & Akanksha â€” votes saved to Firebase and
          Formspree.
        </footer>
      </div>
    </div>

    <!-- Thank you modal -->
    <div
      class="modalWrap"
      id="modalWrap"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="modal" role="document">
        <h2 id="modalTitle">Thank you!</h2>
        <p id="modalMsg">We appreciate your prediction.</p>
        <button class="btnMain" id="modalClose">Close</button>
      </div>
    </div>

    <!-- FIREBASE + APP LOGIC (anonymous auth + realtime votes + Formspree) -->
    <script type="module">
      const FORMSPREE_ENDPOINT = "https://formspree.io/f/xzzkjneo";

      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        onValue,
        get,
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
      import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

      // Your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyDJMam9PYVpprTjX-hSx4zqoqkp5AOEQaA",
        authDomain: "baby-prediction-2947c.firebaseapp.com",
        projectId: "baby-prediction-2947c",
        storageBucket: "baby-prediction-2947c.firebasestorage.app",
        messagingSenderId: "746431850655",
        appId: "1:746431850655:web:2d3d4cddf4e7fa6e855aaa",
        measurementId: "G-Y4LQT2ZRD5",
      };

      // init firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);

      // UI refs
      const choices = Array.from(document.querySelectorAll(".choice"));
      const boyCountEl = document.getElementById("boyCount");
      const girlCountEl = document.getElementById("girlCount");
      const voteBtn = document.getElementById("voteBtn");
      const shareBtn = document.getElementById("shareBtn");
      const nameInput = document.getElementById("name");
      const relInput = document.getElementById("relation");
      const modalWrap = document.getElementById("modalWrap");
      const modalTitle = document.getElementById("modalTitle");
      const modalMsg = document.getElementById("modalMsg");
      const modalClose = document.getElementById("modalClose");

      const cdDays = document.getElementById("cdDays");
      const cdHours = document.getElementById("cdHours");
      const cdMins = document.getElementById("cdMins");
      const cdSecs = document.getElementById("cdSecs");

      const revealDate = new Date("2025-11-14T00:00:00");

      let myUid = null;

      // Anonymous auth
      async function startAuth() {
        try {
          await signInAnonymously(auth);
        } catch (e) {
          console.error("Auth error", e);
        }
      }
      onAuthStateChanged(auth, (user) => {
        myUid = user ? user.uid : null;
      });
      startAuth();

      // Realtime listener -> authoritative counts
      const votesRef = ref(db, "votes");
      onValue(votesRef, (snap) => {
        const data = snap.val() || {};
        let boy = 0,
          girl = 0;
        for (const uid in data) {
          const v = data[uid] && data[uid].vote;
          if (v === "boy") boy++;
          if (v === "girl") girl++;
        }
        boyCountEl.textContent = boy;
        girlCountEl.textContent = girl;

        // highlight my vote
        if (myUid && data[myUid]) {
          const myVote = data[myUid].vote;
          choices.forEach((c) =>
            c.classList.toggle("selected", c.dataset.value === myVote)
          );
        }
      });

      // submit vote: write to Firebase and post to Formspree
      async function submitVote(voteValue) {
        if (!myUid) {
          await startAuth();
          await new Promise((r) => setTimeout(r, 250));
        }
        if (!myUid) {
          alert("Unable to sign in. Please try again.");
          return;
        }
        // read previous vote
        let previousVote = "";
        try {
          const snap = await get(ref(db, `votes/${myUid}`));
          const prev = snap.exists() ? snap.val() : null;
          previousVote = prev && prev.vote ? prev.vote : "";
        } catch (e) {
          console.warn("read prev err", e);
        }

        const payload = {
          vote: voteValue,
          name: (nameInput.value || "").trim(),
          relation: (relInput.value || "").trim(),
          time: new Date().toISOString(),
        };

        try {
          await set(ref(db, `votes/${myUid}`), payload);
        } catch (e) {
          console.error("Firebase write error", e);
          alert("Could not record vote â€” check connection.");
          return;
        }

        // send to Formspree (non-blocking)
        try {
          const body = {
            event: "vote",
            previous_vote: previousVote || "",
            new_vote: voteValue,
            name: payload.name,
            relation: payload.relation,
            time: payload.time,
          };
          fetch(FORMSPREE_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body),
          }).catch((e) => console.warn("Formspree failed", e));
        } catch (e) {
          console.warn("Formspree error", e);
        }
      }

      // UI selection
      let selectedValue = null;
      choices.forEach((c) => {
        c.addEventListener("click", () => {
          choices.forEach((x) => x.classList.remove("selected"));
          c.classList.add("selected");
          selectedValue = c.dataset.value;
        });
        c.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            c.click();
          }
        });
      });

      voteBtn.addEventListener("click", async () => {
        const toVote = selectedValue;
        if (!toVote) {
          alert("Please select Boy or Girl to vote.");
          return;
        }
        await submitVote(toVote);
        const nm = (nameInput.value || "").trim(),
          rel = (relInput.value || "").trim();
        const who = nm
          ? `${nm}${rel ? " (" + rel + ")" : ""}`
          : rel
          ? rel
          : "Friend";
        showThankYou(who, toVote);
        launchConfetti();
      });

      shareBtn.addEventListener("click", () => {
        const txt = encodeURIComponent(
          `Join Aman & Akankshaâ€™s Royal Baby Reveal â€” Cast your prediction: ${location.href}`
        );
        if (navigator.share)
          navigator
            .share({
              title: "Royal Baby Reveal",
              text: "Make your prediction!",
              url: location.href,
            })
            .catch(() => {});
        else window.open("https://wa.me/?text=" + txt, "_blank");
      });

      function showThankYou(who, vote) {
        modalTitle.textContent = `Thank you, ${who}!`;
        modalMsg.innerHTML = `Your royal prediction is recorded: <strong>${
          vote === "boy" ? "Prince ðŸ‘‘" : "Princess ðŸ‘‘"
        }</strong>.<br/>We appreciate your blessings.`;
        modalWrap.style.display = "flex";
        modalWrap.setAttribute("aria-hidden", "false");
        setTimeout(() => closeModal(), 4000);
      }
      function closeModal() {
        modalWrap.style.display = "none";
        modalWrap.setAttribute("aria-hidden", "true");
      }
      modalClose.addEventListener("click", closeModal);
      modalWrap.addEventListener("click", (e) => {
        if (e.target === modalWrap) closeModal();
      });

      // countdown
      function updateCountdown() {
        const now = new Date();
        const diff = revealDate.getTime() - now.getTime();
        if (diff <= 0) {
          cdDays.textContent = "0";
          cdHours.textContent = "0";
          cdMins.textContent = "0";
          cdSecs.textContent = "0";
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor(
          (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );
        const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((diff % (1000 * 60)) / 1000);
        cdDays.textContent = days;
        cdHours.textContent = hours;
        cdMins.textContent = mins;
        cdSecs.textContent = secs;
      }
      updateCountdown();
      setInterval(updateCountdown, 1000);

      // confetti
      const canvas = document.getElementById("confetti");
      const ctx = canvas.getContext && canvas.getContext("2d");
      let confetti = [],
        confAnim = false;
      function resizeCanvas() {
        if (!ctx) return;
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      function launchConfetti() {
        if (!ctx) return;
        for (let i = 0; i < 70; i++) {
          confetti.push({
            x: Math.random() * canvas.width,
            y: (-Math.random() * canvas.height) / 2,
            w: 6 + Math.random() * 10,
            h: 8 + Math.random() * 10,
            vx: (Math.random() - 0.5) * 4,
            vy: 2 + Math.random() * 4,
            rot: Math.random() * 360,
            vr: (Math.random() - 0.5) * 8,
            color: ["#d4af37", "#f9e6b0", "#ffd37a"][
              Math.floor(Math.random() * 3)
            ],
          });
        }
        if (!confAnim) animateConfetti();
      }
      function animateConfetti() {
        confAnim = true;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = confetti.length - 1; i >= 0; i--) {
          const p = confetti[i];
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.06;
          p.rot += p.vr;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate((p.rot * Math.PI) / 180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
          ctx.restore();
          if (p.y > canvas.height + 50) confetti.splice(i, 1);
        }
        if (confetti.length) requestAnimationFrame(animateConfetti);
        else {
          confAnim = false;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }

      // keyboard nav
      choices.forEach((c, i) =>
        c.addEventListener("keydown", (e) => {
          if (e.key === "ArrowDown" || e.key === "ArrowRight")
            choices[(i + 1) % choices.length].focus();
          if (e.key === "ArrowUp" || e.key === "ArrowLeft")
            choices[(i - 1 + choices.length) % choices.length].focus();
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            c.click();
          }
        })
      );
    </script>
  </body>
</html>
